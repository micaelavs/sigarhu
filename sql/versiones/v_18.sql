CREATE TABLE `dependencias_historicas` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `id_dependencia` INT(11) NOT NULL,
  `id_padre` INT(11) NOT NULL,
  `fecha_desde` DATE NOT NULL,
  `fecha_hasta` DATE NULL DEFAULT NULL,
  PRIMARY KEY (`id`)
 )ENGINE=InnoDB DEFAULT CHARSET=utf8;

DELIMITER $$
DROP TRIGGER IF EXISTS dependencias_historicas_tg_alta$$
CREATE TRIGGER `dependencias_historicas_tg_alta` AFTER INSERT ON `dependencias_historicas` FOR EACH ROW
BEGIN
INSERT INTO sigarhu_historial.dependencias_historicas
    (
    `id_dependencias_historicas`,
    `id_usuario`,
    `fecha_operacion`,
    `tipo_operacion`,
    `id_dependencia`,  
    `id_padre`,  
    `fecha_desde`,
    `fecha_hasta`
    )
VALUES
    (
    NEW.id,
    @id_usuario,
    NOW(),
    "A",
    NEW.id_dependencia,
    NEW.id_padre,
    NEW.fecha_desde,
    NEW.fecha_hasta
    );
END$$
DELIMITER ;


DELIMITER $$
DROP TRIGGER IF EXISTS dependencias_historicas_tg_modificacion$$
CREATE TRIGGER `dependencias_historicas_tg_modificacion` AFTER UPDATE ON `dependencias_historicas` FOR EACH ROW
BEGIN
INSERT INTO sigarhu_historial.dependencias_historicas
    (
    `id_dependencias_historicas`,
    `id_usuario`,
    `fecha_operacion`,
    `tipo_operacion`,
    `id_dependencia`,  
    `id_padre`,  
    `fecha_desde`,
    `fecha_hasta`
    )
VALUES
    (
    OLD.id,
    @id_usuario,
    NOW(),
    IF(NEW.fecha_hasta <> "", "B", "M"),
    NEW.id_dependencia,
    NEW.id_padre,
    NEW.fecha_desde,
    NEW.fecha_hasta
    );
END$$
DELIMITER ;



SET @id_usuario:=99999999;
INSERT INTO dependencias_historicas (id_dependencia, id_padre, fecha_desde, fecha_hasta) VALUES
('1', '0', '2015-12-10', NULL),
('2', '1', '2015-12-10', NULL),
('3', '1', '2015-12-10', NULL),
('4', '1', '2015-12-10', NULL),
('5', '1', '2015-12-10', NULL),
('6', '1', '2015-12-10', NULL),
('7', '1', '2015-12-10', NULL),
('8', '1', '2015-12-10', NULL),
('9', '1', '2015-12-10', NULL),
('10', '1', '2015-12-10', NULL),
('120', '1', '2015-12-10', NULL),
('134', '1', '2015-12-10', NULL),
('11', '2', '2015-12-10', NULL),
('12', '2', '2015-12-10', NULL),
('13', '2', '2015-12-10', NULL),
('14', '3', '2015-12-10', NULL),
('15', '3', '2015-12-10', NULL),
('16', '3', '2015-12-10', NULL),
('17', '3', '2015-12-10', NULL),
('18', '3', '2015-12-10', NULL),
('19', '3', '2015-12-10', NULL),
('20', '4', '2015-12-10', NULL),
('21', '4', '2015-12-10', NULL),
('22', '4', '2015-12-10', NULL),
('23', '4', '2015-12-10', NULL),
('24', '4', '2015-12-10', NULL),
('119', '4', '2015-12-10', NULL),
('123', '4', '2015-12-10', NULL),
('135', '4', '2015-12-10', NULL),
('25', '5', '2015-12-10', NULL),
('26', '5', '2015-12-10', NULL),
('27', '5', '2015-12-10', NULL),
('28', '5', '2015-12-10', NULL),
('122', '5', '2015-12-10', NULL),
('29', '6', '2015-12-10', NULL),
('30', '6', '2015-12-10', NULL),
('31', '6', '2015-12-10', NULL),
('32', '6', '2015-12-10', NULL),
('33', '6', '2015-12-10', NULL),
('34', '6', '2015-12-10', NULL),
('35', '6', '2015-12-10', NULL),
('36', '6', '2015-12-10', NULL),
('37', '6', '2015-12-10', NULL),
('132', '6', '2015-12-10', NULL),
('38', '11', '2015-12-10', NULL),
('39', '11', '2015-12-10', NULL),
('40', '12', '2015-12-10', NULL),
('41', '12', '2015-12-10', NULL),
('42', '12', '2015-12-10', NULL),
('90', '13', '2015-12-10', NULL),
('91', '13', '2015-12-10', NULL),
('92', '14', '2015-12-10', NULL),
('93', '14', '2015-12-10', NULL),
('43', '15', '2015-12-10', NULL),
('44', '15', '2015-12-10', NULL),
('45', '15', '2015-12-10', NULL),
('136', '15', '2015-12-10', NULL),
('46', '16', '2015-12-10', NULL),
('47', '16', '2015-12-10', NULL),
('129', '16', '2015-12-10', NULL),
('48', '17', '2015-12-10', NULL),
('49', '17', '2015-12-10', NULL),
('50', '17', '2015-12-10', NULL),
('51', '17', '2015-12-10', NULL),
('52', '18', '2015-12-10', NULL),
('53', '18', '2015-12-10', NULL),
('54', '18', '2015-12-10', NULL),
('55', '18', '2015-12-10', NULL),
('137', '18', '2015-12-10', NULL),
('56', '20', '2015-12-10', NULL),
('57', '20', '2015-12-10', NULL),
('58', '20', '2015-12-10', NULL),
('59', '22', '2015-12-10', NULL),
('60', '22', '2015-12-10', NULL),
('61', '23', '2015-12-10', NULL),
('62', '23', '2015-12-10', NULL),
('117', '24', '2015-12-10', NULL),
('118', '24', '2015-12-10', NULL),
('63', '25', '2015-12-10', NULL),
('64', '25', '2015-12-10', NULL),
('65', '34', '2015-12-10', NULL),
('66', '34', '2015-12-10', NULL),
('67', '34', '2015-12-10', NULL),
('68', '34', '2015-12-10', NULL),
('69', '34', '2015-12-10', NULL),
('70', '34', '2015-12-10', NULL),
('71', '35', '2015-12-10', NULL),
('72', '35', '2015-12-10', NULL),
('73', '35', '2015-12-10', NULL),
('74', '36', '2015-12-10', NULL),
('75', '36', '2015-12-10', NULL),
('76', '36', '2015-12-10', NULL),
('77', '37', '2015-12-10', NULL),
('78', '37', '2015-12-10', NULL),
('79', '37', '2015-12-10', NULL),
('80', '38', '2015-12-10', NULL),
('81', '38', '2015-12-10', NULL),
('82', '38', '2015-12-10', NULL),
('83', '39', '2015-12-10', NULL),
('84', '40', '2015-12-10', NULL),
('85', '40', '2015-12-10', NULL),
('86', '41', '2015-12-10', NULL),
('87', '41', '2015-12-10', NULL),
('88', '42', '2015-12-10', NULL),
('89', '42', '2015-12-10', NULL),
('94', '44', '2015-12-10', NULL),
('95', '44', '2015-12-10', NULL),
('96', '46', '2015-12-10', NULL),
('97', '46', '2015-12-10', NULL),
('130', '46', '2015-12-10', NULL),
('98', '47', '2015-12-10', NULL),
('99', '49', '2015-12-10', NULL),
('100', '49', '2015-12-10', NULL),
('101', '50', '2015-12-10', NULL),
('102', '50', '2015-12-10', NULL),
('103', '52', '2015-12-10', NULL),
('104', '53', '2015-12-10', NULL),
('105', '53', '2015-12-10', NULL),
('106', '54', '2015-12-10', NULL),
('107', '54', '2015-12-10', NULL),
('108', '54', '2015-12-10', NULL),
('131', '54', '2015-12-10', NULL),
('109', '59', '2015-12-10', NULL),
('110', '59', '2015-12-10', NULL),
('111', '60', '2015-12-10', NULL),
('112', '60', '2015-12-10', NULL),
('113', '61', '2015-12-10', NULL),
('114', '61', '2015-12-10', NULL),
('115', '62', '2015-12-10', NULL),
('116', '62', '2015-12-10', NULL),
('121', '120', '2015-12-10', NULL),
('124', '121', '2015-12-10', NULL),
('125', '121', '2015-12-10', NULL),
('126', '121', '2015-12-10', NULL),
('127', '121', '2015-12-10', NULL),
('128', '121',  '2015-12-10', NULL),
('133', '136',  '2015-12-10', NULL),
('138', '1',  '2019-12-20', NULL),
('139', '1',  '2019-12-20', NULL),
('140', '1',  '2019-12-20', NULL);


INSERT INTO db_version VALUES('18.0', now());